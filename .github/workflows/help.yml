name: 'Help'

on:
  issue_comment:
    types: [created]

permissions:
  issues: write
  pull-requests: write

jobs:
  help:
    runs-on: ubuntu-latest
    if: github.event.issue.pull_request && github.event.comment.body == '/help'
    
    steps:
      - name: Show Commands
        uses: actions/github-script@v7
        with:
          script: |
            const message = `### ü§ñ Available Terraform Commands

            **Plan Commands:**
            - \`/plan networking\` - Run plan for networking layer
            - \`/plan eks\` - Run plan for EKS cluster layer  
            - \`/plan all\` - Run plan for all layers

            **Deploy Commands:**
            - \`/deploy networking\` - Apply networking layer changes
            - \`/deploy eks\` - Apply EKS cluster changes
            - \`/deploy argo\` - Install ArgoCD
            - \`/deploy all\` - Apply all layers (networking ‚Üí eks)

            **Destroy Commands:**
            - \`/destroy networking\` - Request to destroy networking layer
            - \`/destroy eks\` - Request to destroy EKS cluster layer
            - \`/destroy argo\` - Request to destory ArgoCD resources
            - \`/destroy all\` - Request to destroy all infrastructure
            - \`/destroy <layer> --confirm\` - Confirm and execute destroy

            **Other:**
            - \`/help\` - Show this help message

            ---

            **‚ö†Ô∏è Important Notes:**
            - Apply commands automatically approve and apply changes
            - Destroy commands require \`--confirm\` flag for safety
            - When destroying all, EKS is destroyed first, then networking
            - All commands operate on the PR branch code

            **Recommended workflow:**
            1. \`/plan <layer>\` - Preview changes
            2. \`/apply <layer>\` - Apply if plan looks good
            3. \`/destroy <layer>\` - Request destroy (shows confirmation)
            4. \`/destroy <layer> --confirm\` - Confirm and execute`;

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: message
            });